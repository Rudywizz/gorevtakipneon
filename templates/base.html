<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Görev Takip Sistemi{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <!-- Tema + UI İyileştirme CSS -->
    <style>
      /* ----- Genel geçişler ----- */
      * { transition: color .15s ease, background-color .15s ease, border-color .15s ease; }
      @media (prefers-reduced-motion: reduce) { * { transition: none !important; } }
      body { transition: background-color .2s ease, color .2s ease; }

      /* ----- Koyu tema ----- */
      body.dark-mode { background-color: #121212 !important; color: #f1f1f1 !important; }
      body.dark-mode .navbar { background-color: #1f1f1f !important; }

      body.dark-mode .card,
      body.dark-mode .container,
      body.dark-mode .table,
      body.dark-mode .modal-content,
      body.dark-mode .dropdown-menu {
        background-color: #1e1e1e !important;
        color: #f1f1f1 !important;
        border-color: #444 !important;
      }
      body.dark-mode .table > :not(caption) > * > * {
        background-color: #1f1f1f !important; color: #e8e8e8 !important; border-color: #444 !important;
      }
      body.dark-mode .table thead th { background-color: #242424 !important; color: #f1f1f1 !important; }

      /* Form elemanları */
      body.dark-mode .form-control,
      body.dark-mode .form-select,
      body.dark-mode input,
      body.dark-mode select,
      body.dark-mode textarea {
        background-color: #2a2a2a !important; color: #f1f1f1 !important; border: 1px solid #555 !important;
      }
      body.dark-mode input::placeholder, body.dark-mode textarea::placeholder { color: #aaa !important; }
      body.dark-mode .form-select option { background-color: #2a2a2a; color: #f1f1f1; }
      body.dark-mode .form-control:focus, body.dark-mode .form-select:focus {
        background-color: #2a2a2a !important; color: #fff !important;
        border-color: #6ea8fe !important; box-shadow: 0 0 0 .2rem rgba(13,110,253,.25) !important;
      }

      /* Butonlar */
      body.dark-mode .btn { border-color: #555 !important; }
      body.dark-mode .btn-outline-light { color: #f1f1f1 !important; border-color: #777 !important; }
      body.dark-mode .btn-outline-light:hover { background-color: #2a2a2a !important; }
      body.dark-mode .btn-primary { background-color: #0d6efd !important; border-color: #0d6efd !important; }

      /* Badge/alert kontrast */
      body.dark-mode .badge, body.dark-mode .alert { color: #f1f1f1 !important; }

      /* ----- Kart & buton “elevation” ----- */
      .card-elevate { border: 1px solid rgba(0,0,0,.06); box-shadow: 0 6px 18px rgba(0,0,0,.08); border-radius: 14px; }
      .card-elevate:hover { box-shadow: 0 10px 24px rgba(0,0,0,.12); }
      body.dark-mode .card-elevate { border-color: #333; box-shadow: 0 6px 18px rgba(0,0,0,.6); }
      body.dark-mode .card-elevate:hover { box-shadow: 0 10px 28px rgba(0,0,0,.7); }

      .btn-elevate { transform: translateY(0); box-shadow: 0 2px 6px rgba(0,0,0,.12); border-radius: 10px; }
      .btn-elevate:hover { transform: translateY(-1px); box-shadow: 0 6px 14px rgba(0,0,0,.18); }
      .btn-elevate:active { transform: translateY(0); box-shadow: 0 3px 8px rgba(0,0,0,.16); }
      .btn-elevate:focus-visible { outline: none; box-shadow: 0 0 0 .22rem rgba(13,110,253,.35); }

      /* ----- Ripple animasyonu ----- */
      .ripple-wrap { position: relative; overflow: hidden; }
      .ripple { position: absolute; border-radius: 50%; transform: scale(0); opacity: .55; animation: ripple .5s ease-out; background: currentColor; pointer-events: none; }
      @keyframes ripple { to { transform: scale(12); opacity: 0; } }

      /* ----- Navbar linkleri: modern hover/active ----- */
      .nav-link-modern { border-radius: 8px; padding: .5rem .75rem; }
      .navbar-dark .nav-link-modern:hover { background: rgba(255,255,255,.12); }
      .navbar-dark .nav-link-modern.active { background: rgba(255,255,255,.22); font-weight: 600; }
      body.dark-mode .navbar .nav-link-modern:hover { background: rgba(255,255,255,.10); }
      body.dark-mode .navbar .nav-link-modern.active { background: rgba(255,255,255,.18); }

      /* Tema butonu ikon dokunuşu */
      #themeToggle i { transition: transform .18s ease; display: inline-block; }
      #themeToggle:active i { transform: scale(.9) rotate(-8deg); }
    </style>
</head>
<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-4">
  <div class="container-fluid">

    <!-- LOGO + METİN -->
    <a class="navbar-brand d-flex align-items-center gap-2" href="{{ url_for('dashboard') }}">
      <img src="{{ url_for('static', filename='images/karacabey-logo.png') }}" alt="Karacabey Belediyesi" height="32" class="d-inline-block align-text-top">
      <span class="fw-semibold">BIM Görev Takip</span>
    </a>

    {% if session.get('user_id') %}
      <!-- Mobil menü butonu -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
              aria-controls="navbarNav" aria-expanded="false" aria-label="Menüyü Aç/Kapat">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- Menüler -->
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link nav-link-modern {{ 'active' if request.endpoint == 'dashboard' else '' }}"
               href="{{ url_for('dashboard') }}">
              <i class="bi bi-list-task me-1"></i> Tüm Görevler
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link nav-link-modern {{ 'active' if request.endpoint == 'assigned_tasks' else '' }}"
               href="{{ url_for('assigned_tasks') }}">
              <i class="bi bi-person-check-fill me-1"></i> Bana Atananlar
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link nav-link-modern {{ 'active' if request.endpoint == 'completed_tasks' else '' }}"
               href="{{ url_for('completed_tasks') }}">
              <i class="bi bi-check2-circle me-1"></i> Tamamlanan Görevler
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link nav-link-modern {{ 'active' if request.endpoint == 'report' else '' }}"
               href="{{ url_for('report') }}">
              <i class="bi bi-graph-up-arrow me-1"></i> Raporlama
            </a>
          </li>
        </ul>

        <div class="d-flex align-items-center">
          {% if session.get('username') %}
            <span class="navbar-text text-white me-3">
              <i class="bi bi-person-circle me-1"></i> <strong>{{ session['username'] }}</strong>
            </span>
          {% endif %}
          <a class="btn btn-outline-light btn-elevate ripple-wrap" href="{{ url_for('logout') }}">
            <i class="bi bi-box-arrow-right me-1"></i> Çıkış Yap
          </a>
          <!-- Tema Toggle Butonu -->
          <button id="themeToggle" class="btn btn-outline-light btn-elevate ripple-wrap ms-2" type="button" aria-label="Tema Değiştir">
            <i class="bi bi-moon-fill"></i>
          </button>
        </div>
      </div>
    {% endif %}

  </div>
</nav>

<div class="container">
    {% block content %}{% endblock %}
</div>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Tema Toggle + Ripple JS -->
<script>
(function () {
  // Kayıtlı tema/sistem teması
  const body = document.body;
  try {
    const saved = localStorage.getItem('theme');
    if (!saved && window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      body.classList.add('dark-mode'); localStorage.setItem('theme', 'dark');
    } else if (saved === 'dark') {
      body.classList.add('dark-mode');
    }
  } catch (e) {}

  document.addEventListener('DOMContentLoaded', function () {
    const btn = document.getElementById('themeToggle');
    if (btn) {
      const setIcon = () => { btn.innerHTML = body.classList.contains('dark-mode') ? '<i class="bi bi-sun-fill"></i>' : '<i class="bi bi-moon-fill"></i>'; };
      setIcon();
      btn.addEventListener('click', function () {
        body.classList.toggle('dark-mode');
        try { localStorage.setItem('theme', body.classList.contains('dark-mode') ? 'dark' : 'light'); } catch (e) {}
        setIcon();
      });
    }

    // Ripple
    document.addEventListener('click', function(e) {
      const target = e.target.closest('.ripple-wrap');
      if (!target) return;
      const rect = target.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      const ripple = document.createElement('span');
      ripple.className = 'ripple';
      ripple.style.width = ripple.style.height = size + 'px';
      ripple.style.left = (e.clientX - rect.left - size/2) + 'px';
      ripple.style.top  = (e.clientY - rect.top  - size/2) + 'px';
      target.appendChild(ripple);
      setTimeout(() => ripple.remove(), 500);
    }, false);

    // Eğer request.endpoint kullanmıyorsan, URL'ye göre aktif sınıfını atamak için alternatif:
    // const path = location.pathname;
    // document.querySelectorAll('.nav-link-modern').forEach(a => { if (a.getAttribute('href') === path) a.classList.add('active'); });
  });
})();
</script>
</body>
</html>
